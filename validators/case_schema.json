{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "required": [
    "id",
    "title",
    "problem_summary",
    "user_symptoms",
    "origin",
    "layer",
    "severity",
    "owner_team"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^NG-TROUBLE-\\d{3}$"
    },

    "title": {
      "type": "string",
      "minLength": 5
    },

    "problem_summary": {
      "type": "string",
      "minLength": 10
    },

    "user_symptoms": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string",
        "minLength": 3
      }
    },

    "origin": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string"
      }
    },

    "layer": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string"
      }
    },

    "severity": {
      "type": "object",
      "required": ["user_impact"],
      "properties": {
        "user_impact": {
          "type": "string",
          "enum": ["baixa", "media", "alta"]
        },
        "system_impact": {
          "type": "string",
          "enum": ["baixa", "media", "alta"]
        }
      },
      "additionalProperties": false
    },

    "root_causes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["description", "confidence"],
        "properties": {
          "description": {
            "type": "string",
            "minLength": 5
          },
          "confidence": {
            "type": "string",
            "enum": ["baixa", "media", "alta"]
          }
        },
        "additionalProperties": false
      }
    },

    "business_rule": {
      "type": "array",
      "items": {
        "oneOf": [
          {
            "type": "string",
            "minLength": 5
          },
          {
            "type": "object",
            "required": ["description"],
            "properties": {
              "description": {
                "type": "string",
                "minLength": 5
              },
              "scope": {
                "type": "string",
                "minLength": 2
              }
            },
            "additionalProperties": false
          }
        ]
      }
    },

    "resolution_steps": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 3
      }
    },

    "triage_questions": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 5
      }
    },

    "evidence_to_collect": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 3
      }
    },

    "do_not_do": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 3
      }
    },

    "owner_team": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string"
      }
    }
  },

  "anyOf": [
    { "required": ["root_causes"] },
    { "required": ["business_rule"] },
    { "required": ["resolution_steps"] }
  ],

  "additionalProperties": true
}
